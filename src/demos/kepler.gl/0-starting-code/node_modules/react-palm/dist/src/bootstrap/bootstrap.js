"use strict";
var __assign = (this && this.__assign) || Object.assign || function(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
            t[p] = s[p];
    }
    return t;
};
Object.defineProperty(exports, "__esModule", { value: true });
var React = require("react");
var redux_1 = require("redux");
var react_redux_1 = require("react-redux");
var subscriptions_1 = require("../subscriptions");
var tasks_1 = require("../tasks");
var child_route_1 = require("../routing/child-route");
function makeStore(_a) {
    var subscribe = _a.subscribe, reducer = _a.reducer;
    return redux_1.createStore(reducer, redux_1.applyMiddleware(tasks_1.taskMiddleware, subscriptions_1.makeSubscriptionMiddleware(subscribe)));
}
exports.makeStore = makeStore;
function connectApp(_a) {
    var store = _a.store, App = _a.App;
    var RootRoute = function (props) {
        var routes = props.routing.routes;
        return (React.createElement(child_route_1.default, __assign({}, props, { routes: routes })));
    };
    var ConnectedApp = react_redux_1.connect(function (state) { return state; }, function (dispatch) { return ({ dispatch: dispatch }); })(RootRoute);
    return (React.createElement(react_redux_1.Provider, { store: store },
        React.createElement(App, null,
            React.createElement(ConnectedApp, null))));
}
exports.connectApp = connectApp;
function bootstrap(_a) {
    var subscribe = _a.subscribe, reducer = _a.reducer, App = _a.App;
    var store = makeStore({ subscribe: subscribe, reducer: reducer });
    var app = connectApp({ store: store, App: App });
    return { app: app, store: store };
}
exports.bootstrap = bootstrap;
//# sourceMappingURL=bootstrap.js.map