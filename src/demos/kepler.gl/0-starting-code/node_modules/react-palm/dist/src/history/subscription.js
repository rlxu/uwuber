"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var subscriptions_1 = require("../subscriptions");
var bootstrap_1 = require("../bootstrap");
exports.HISTORY_SUBSCRIPTION = function (action) {
    return ({ type: exports.HISTORY_SUBSCRIPTION, params: {}, action: action });
};
var subToListener = new Map();
var MAKE_ASYNC_PROMISE = Promise.resolve(null);
subscriptions_1.makeSubscriptionType(exports.HISTORY_SUBSCRIPTION, function (dispatch, added, removed) {
    added.forEach(function (subscription) {
        var listener = function (event) { return dispatch(subscription.action(event)); };
        var unlisten = bootstrap_1.getHistory().listen(function (event) {
            return MAKE_ASYNC_PROMISE
                .then(function () { return listener("" + event.pathname + event.search + event.hash); });
        });
        subToListener.set(subscription, unlisten);
    });
    removed.forEach(function (subscription) {
        var unlisten = subToListener.get(subscription);
        subToListener.delete(subscription);
        unlisten();
    });
});
//# sourceMappingURL=subscription.js.map