'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _taggedTemplateLiteral2 = require('babel-runtime/helpers/taggedTemplateLiteral');

var _taggedTemplateLiteral3 = _interopRequireDefault(_taggedTemplateLiteral2);

var _templateObject = (0, _taggedTemplateLiteral3.default)(['\n  padding: 10px 0 10px ', 'px;\n  font-size: 11px;\n  border-bottom-color: ', ';\n  border-bottom-style: solid;\n  border-bottom-width: ', ';\n\n  .legend--layer_name {\n    font-size: 12px;\n    padding-right: ', 'px;\n    color: ', ';\n    font-weight: 500;\n  }\n  .legend--layer_type {\n    color: ', ';\n    font-weight: 500;\n    font-size: 11px;\n    padding-right: ', 'px;\n  }\n  \n  .legend--layer__title { \n    padding-right: ', 'px;\n  }\n  \n  .legend--layer_by {\n    color: ', ';\n  }\n\n  .legend--layer_color_field {\n    color: ', ';\n    font-weight: 500;\n  }\n\n  .legend--layer_color-legend {\n    margin-top: 6px;\n  }\n'], ['\n  padding: 10px 0 10px ', 'px;\n  font-size: 11px;\n  border-bottom-color: ', ';\n  border-bottom-style: solid;\n  border-bottom-width: ', ';\n\n  .legend--layer_name {\n    font-size: 12px;\n    padding-right: ', 'px;\n    color: ', ';\n    font-weight: 500;\n  }\n  .legend--layer_type {\n    color: ', ';\n    font-weight: 500;\n    font-size: 11px;\n    padding-right: ', 'px;\n  }\n  \n  .legend--layer__title { \n    padding-right: ', 'px;\n  }\n  \n  .legend--layer_by {\n    color: ', ';\n  }\n\n  .legend--layer_color_field {\n    color: ', ';\n    font-weight: 500;\n  }\n\n  .legend--layer_color-legend {\n    margin-top: 6px;\n  }\n']); // Copyright (c) 2018 Uber Technologies, Inc.
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _propTypes = require('prop-types');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _styledComponents = require('styled-components');

var _styledComponents2 = _interopRequireDefault(_styledComponents);

var _d3Color = require('d3-color');

var _colorLegend = require('../common/color-legend');

var _colorLegend2 = _interopRequireDefault(_colorLegend);

var _defaultSettings = require('../../constants/default-settings');

var _utils = require('../../utils/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var StyledMapControlLegend = _styledComponents2.default.div(_templateObject, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.panelBorderColor;
}, function (props) {
  return props.last ? 0 : '1px';
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.textColorHl;
}, function (props) {
  return props.theme.subtextColor;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.mapControl.padding;
}, function (props) {
  return props.theme.subtextColor;
}, function (props) {
  return props.theme.textColor;
});

var VisualChannelMetric = function VisualChannelMetric(_ref) {
  var name = _ref.name;
  return _react2.default.createElement(
    'div',
    { className: 'legend--layer__title' },
    _react2.default.createElement(
      'span',
      { className: 'legend--layer_by' },
      'by '
    ),
    _react2.default.createElement(
      'span',
      { className: 'legend--layer_color_field' },
      name
    )
  );
};

var LayerSize = function LayerSize(_ref2) {
  var label = _ref2.label,
      name = _ref2.name;
  return _react2.default.createElement(
    'div',
    { className: 'legend--layer_size-schema' },
    _react2.default.createElement(
      'p',
      null,
      _react2.default.createElement(
        'span',
        { className: 'legend--layer_by' },
        label
      )
    ),
    _react2.default.createElement(VisualChannelMetric, { name: name })
  );
};

var propTypes = {
  layers: _propTypes2.default.array
};

var MapLegend = function MapLegend(_ref3) {
  var layers = _ref3.layers;
  return _react2.default.createElement(
    'div',
    null,
    layers.map(function (layer, index) {
      var enableColorBy = layer.config.colorField ? layer.config.colorField.name : layer.visualChannels.color.defaultMeasure;

      if (!layer.isValidToSave()) {
        return null;
      }

      return _react2.default.createElement(
        StyledMapControlLegend,
        {
          className: 'legend--layer',
          last: index === layers.length - 1,
          key: index
        },
        _react2.default.createElement(
          'div',
          { className: 'legend--layer_name' },
          layer.config.label
        ),
        _react2.default.createElement(
          'div',
          { className: 'legend--layer_type' },
          (0, _utils.capitalizeFirstLetter)(layer.name) + ' color'
        ),
        _react2.default.createElement(
          'div',
          { className: 'legend--layer_color-schema' },
          _react2.default.createElement(
            'div',
            null,
            enableColorBy ? _react2.default.createElement(VisualChannelMetric, { name: enableColorBy }) : null,
            _react2.default.createElement(
              'div',
              { className: 'legend--layer_color-legend' },
              _react2.default.createElement(_colorLegend2.default, {
                scaleType: enableColorBy ? layer.config.colorScale : 'ordinal',
                displayLabel: enableColorBy,
                domain: enableColorBy ? layer.config.colorDomain : [''],
                fieldType: enableColorBy ? layer.config.colorField && layer.config.colorField.type || 'real' : null,
                range: enableColorBy ? layer.config.visConfig.colorRange.colors : [_d3Color.rgb.apply(undefined, (0, _toConsumableArray3.default)(layer.config.color)).toString()],
                width: _defaultSettings.DIMENSIONS.mapControl.width - 2 * _defaultSettings.DIMENSIONS.mapControl.padding
              })
            )
          )
        ),
        Object.keys(layer.visualChannels).filter(function (k) {
          return k !== 'color';
        }).map(function (key) {
          var matchCondition = !layer.visualChannels[key].condition || layer.visualChannels[key].condition(layer.config);
          var enabled = layer.config[layer.visualChannels[key].field] || layer.visualChannels[key].defaultMeasure;
          if (matchCondition && enabled) {
            return _react2.default.createElement(LayerSize, {
              key: key,
              label: layer.visConfigSettings[layer.visualChannels[key].range].label,
              name: layer.config[layer.visualChannels[key].field] ? layer.config[layer.visualChannels[key].field].name : layer.visualChannels[key].defaultMeasure
            });
          }
          return null;
        })
      );
    })
  );
};

MapLegend.propTypes = propTypes;

exports.default = MapLegend;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL21hcC9tYXAtbGVnZW5kLmpzIl0sIm5hbWVzIjpbIlN0eWxlZE1hcENvbnRyb2xMZWdlbmQiLCJzdHlsZWQiLCJkaXYiLCJwcm9wcyIsInRoZW1lIiwibWFwQ29udHJvbCIsInBhZGRpbmciLCJwYW5lbEJvcmRlckNvbG9yIiwibGFzdCIsInRleHRDb2xvckhsIiwic3VidGV4dENvbG9yIiwidGV4dENvbG9yIiwiVmlzdWFsQ2hhbm5lbE1ldHJpYyIsIm5hbWUiLCJMYXllclNpemUiLCJsYWJlbCIsInByb3BUeXBlcyIsImxheWVycyIsIlByb3BUeXBlcyIsImFycmF5IiwiTWFwTGVnZW5kIiwibWFwIiwibGF5ZXIiLCJpbmRleCIsImVuYWJsZUNvbG9yQnkiLCJjb25maWciLCJjb2xvckZpZWxkIiwidmlzdWFsQ2hhbm5lbHMiLCJjb2xvciIsImRlZmF1bHRNZWFzdXJlIiwiaXNWYWxpZFRvU2F2ZSIsImxlbmd0aCIsImNvbG9yU2NhbGUiLCJjb2xvckRvbWFpbiIsInR5cGUiLCJ2aXNDb25maWciLCJjb2xvclJhbmdlIiwiY29sb3JzIiwicmdiIiwidG9TdHJpbmciLCJESU1FTlNJT05TIiwid2lkdGgiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwiayIsIm1hdGNoQ29uZGl0aW9uIiwia2V5IiwiY29uZGl0aW9uIiwiZW5hYmxlZCIsImZpZWxkIiwidmlzQ29uZmlnU2V0dGluZ3MiLCJyYW5nZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7bzFDQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUNBOzs7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFNQSx5QkFBeUJDLDJCQUFPQyxHQUFoQyxrQkFDbUI7QUFBQSxTQUFTQyxNQUFN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TUssY0FBTixDQUFxQm9CLEdBQXJCLEVBQTBCSyxLQUFsRCxFQUNHckMsS0FKUDtBQU1FLG9CQUNFTyxNQUFNRyxNQUFOLENBQWFILE1BQU1LLGNBQU4sQ0FBcUJvQixHQUFyQixFQUEwQkcsS0FBdkMsSUFDSTVCLE1BQU1HLE1BQU4sQ0FBYUgsTUFBTUssY0FBTixDQUFxQm9CLEdBQXJCLEVBQTBCRyxLQUF2QyxFQUE4Q3JDLElBRGxELEdBRUlTLE1BQU1LLGNBQU4sQ0FBcUJvQixHQUFyQixFQUEwQmxCO0FBVGxDLGNBREY7QUFjRDtBQUNELGlCQUFPLElBQVA7QUFDRCxTQTFCRjtBQXpDSCxPQURGO0FBdUVELEtBaEZBO0FBREgsR0FEZ0I7QUFBQSxDQUFsQjs7QUFzRkFULFVBQVVKLFNBQVYsR0FBc0JBLFNBQXRCOztrQkFFZUksUyIsImZpbGUiOiJtYXAtbGVnZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE4IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCB7cmdifSBmcm9tICdkMy1jb2xvcic7XG5pbXBvcnQgQ29sb3JMZWdlbmQgZnJvbSAnY29tcG9uZW50cy9jb21tb24vY29sb3ItbGVnZW5kJztcbmltcG9ydCB7RElNRU5TSU9OU30gZnJvbSAnY29uc3RhbnRzL2RlZmF1bHQtc2V0dGluZ3MnO1xuaW1wb3J0IHtjYXBpdGFsaXplRmlyc3RMZXR0ZXJ9IGZyb20gJ3V0aWxzL3V0aWxzJztcblxuY29uc3QgU3R5bGVkTWFwQ29udHJvbExlZ2VuZCA9IHN0eWxlZC5kaXZgXG4gIHBhZGRpbmc6IDEwcHggMCAxMHB4ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4O1xuICBmb250LXNpemU6IDExcHg7XG4gIGJvcmRlci1ib3R0b20tY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUucGFuZWxCb3JkZXJDb2xvcn07XG4gIGJvcmRlci1ib3R0b20tc3R5bGU6IHNvbGlkO1xuICBib3JkZXItYm90dG9tLXdpZHRoOiAke3Byb3BzID0+IChwcm9wcy5sYXN0ID8gMCA6ICcxcHgnKX07XG5cbiAgLmxlZ2VuZC0tbGF5ZXJfbmFtZSB7XG4gICAgZm9udC1zaXplOiAxMnB4O1xuICAgIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4O1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRleHRDb2xvckhsfTtcbiAgICBmb250LXdlaWdodDogNTAwO1xuICB9XG4gIC5sZWdlbmQtLWxheWVyX3R5cGUge1xuICAgIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnN1YnRleHRDb2xvcn07XG4gICAgZm9udC13ZWlnaHQ6IDUwMDtcbiAgICBmb250LXNpemU6IDExcHg7XG4gICAgcGFkZGluZy1yaWdodDogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5tYXBDb250cm9sLnBhZGRpbmd9cHg7XG4gIH1cbiAgXG4gIC5sZWdlbmQtLWxheWVyX190aXRsZSB7IFxuICAgIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUubWFwQ29udHJvbC5wYWRkaW5nfXB4O1xuICB9XG4gIFxuICAubGVnZW5kLS1sYXllcl9ieSB7XG4gICAgY29sb3I6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc3VidGV4dENvbG9yfTtcbiAgfVxuXG4gIC5sZWdlbmQtLWxheWVyX2NvbG9yX2ZpZWxkIHtcbiAgICBjb2xvcjogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS50ZXh0Q29sb3J9O1xuICAgIGZvbnQtd2VpZ2h0OiA1MDA7XG4gIH1cblxuICAubGVnZW5kLS1sYXllcl9jb2xvci1sZWdlbmQge1xuICAgIG1hcmdpbi10b3A6IDZweDtcbiAgfVxuYDtcblxuY29uc3QgVmlzdWFsQ2hhbm5lbE1ldHJpYyA9ICh7bmFtZX0pID0+IChcbiAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX190aXRsZVwiPlxuICAgIDxzcGFuIGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfYnlcIj5ieSA8L3NwYW4+XG4gICAgPHNwYW4gY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllcl9jb2xvcl9maWVsZFwiPntuYW1lfTwvc3Bhbj5cbiAgPC9kaXY+XG4pO1xuXG5jb25zdCBMYXllclNpemUgPSAoe2xhYmVsLCBuYW1lfSkgPT4gKFxuICA8ZGl2IGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfc2l6ZS1zY2hlbWFcIj5cbiAgICA8cD5cbiAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfYnlcIj57bGFiZWx9PC9zcGFuPlxuICAgIDwvcD5cbiAgICA8VmlzdWFsQ2hhbm5lbE1ldHJpYyBuYW1lPXtuYW1lfSAvPlxuICA8L2Rpdj5cbik7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgbGF5ZXJzOiBQcm9wVHlwZXMuYXJyYXlcbn07XG5cbmNvbnN0IE1hcExlZ2VuZCA9ICh7bGF5ZXJzfSkgPT4gKFxuICA8ZGl2PlxuICAgIHtsYXllcnMubWFwKChsYXllciwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGVuYWJsZUNvbG9yQnkgPSBsYXllci5jb25maWcuY29sb3JGaWVsZFxuICAgICAgICA/IGxheWVyLmNvbmZpZy5jb2xvckZpZWxkLm5hbWVcbiAgICAgICAgOiBsYXllci52aXN1YWxDaGFubmVscy5jb2xvci5kZWZhdWx0TWVhc3VyZTtcblxuICAgICAgaWYgKCFsYXllci5pc1ZhbGlkVG9TYXZlKCkpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxTdHlsZWRNYXBDb250cm9sTGVnZW5kXG4gICAgICAgICAgY2xhc3NOYW1lPVwibGVnZW5kLS1sYXllclwiXG4gICAgICAgICAgbGFzdD17aW5kZXggPT09IGxheWVycy5sZW5ndGggLSAxfVxuICAgICAgICAgIGtleT17aW5kZXh9XG4gICAgICAgID5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfbmFtZVwiPntsYXllci5jb25maWcubGFiZWx9PC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX3R5cGVcIj57YCR7Y2FwaXRhbGl6ZUZpcnN0TGV0dGVyKFxuICAgICAgICAgICAgbGF5ZXIubmFtZVxuICAgICAgICAgICl9IGNvbG9yYH08L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZ2VuZC0tbGF5ZXJfY29sb3Itc2NoZW1hXCI+XG4gICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICB7ZW5hYmxlQ29sb3JCeSA/IChcbiAgICAgICAgICAgICAgICA8VmlzdWFsQ2hhbm5lbE1ldHJpYyBuYW1lPXtlbmFibGVDb2xvckJ5fSAvPlxuICAgICAgICAgICAgICApIDogbnVsbH1cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsZWdlbmQtLWxheWVyX2NvbG9yLWxlZ2VuZFwiPlxuICAgICAgICAgICAgICAgIDxDb2xvckxlZ2VuZFxuICAgICAgICAgICAgICAgICAgc2NhbGVUeXBlPXtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ29sb3JCeSA/IGxheWVyLmNvbmZpZy5jb2xvclNjYWxlIDogJ29yZGluYWwnXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBkaXNwbGF5TGFiZWw9e2VuYWJsZUNvbG9yQnl9XG4gICAgICAgICAgICAgICAgICBkb21haW49e2VuYWJsZUNvbG9yQnkgPyBsYXllci5jb25maWcuY29sb3JEb21haW4gOiBbJyddfVxuICAgICAgICAgICAgICAgICAgZmllbGRUeXBlPXtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ29sb3JCeVxuICAgICAgICAgICAgICAgICAgICAgID8gKGxheWVyLmNvbmZpZy5jb2xvckZpZWxkICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNvbmZpZy5jb2xvckZpZWxkLnR5cGUpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAncmVhbCdcbiAgICAgICAgICAgICAgICAgICAgICA6IG51bGxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJhbmdlPXtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ29sb3JCeVxuICAgICAgICAgICAgICAgICAgICAgID8gbGF5ZXIuY29uZmlnLnZpc0NvbmZpZy5jb2xvclJhbmdlLmNvbG9yc1xuICAgICAgICAgICAgICAgICAgICAgIDogW3JnYiguLi5sYXllci5jb25maWcuY29sb3IpLnRvU3RyaW5nKCldXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB3aWR0aD17XG4gICAgICAgICAgICAgICAgICAgIERJTUVOU0lPTlMubWFwQ29udHJvbC53aWR0aCAtXG4gICAgICAgICAgICAgICAgICAgIDIgKiBESU1FTlNJT05TLm1hcENvbnRyb2wucGFkZGluZ1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAge09iamVjdC5rZXlzKGxheWVyLnZpc3VhbENoYW5uZWxzKVxuICAgICAgICAgICAgLmZpbHRlcihrID0+IGsgIT09ICdjb2xvcicpXG4gICAgICAgICAgICAubWFwKGtleSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IG1hdGNoQ29uZGl0aW9uID1cbiAgICAgICAgICAgICAgICAhbGF5ZXIudmlzdWFsQ2hhbm5lbHNba2V5XS5jb25kaXRpb24gfHxcbiAgICAgICAgICAgICAgICBsYXllci52aXN1YWxDaGFubmVsc1trZXldLmNvbmRpdGlvbihsYXllci5jb25maWcpO1xuICAgICAgICAgICAgICBjb25zdCBlbmFibGVkID1cbiAgICAgICAgICAgICAgICBsYXllci5jb25maWdbbGF5ZXIudmlzdWFsQ2hhbm5lbHNba2V5XS5maWVsZF0gfHxcbiAgICAgICAgICAgICAgICBsYXllci52aXN1YWxDaGFubmVsc1trZXldLmRlZmF1bHRNZWFzdXJlO1xuICAgICAgICAgICAgICBpZiAobWF0Y2hDb25kaXRpb24gJiYgZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICA8TGF5ZXJTaXplXG4gICAgICAgICAgICAgICAgICAgIGtleT17a2V5fVxuICAgICAgICAgICAgICAgICAgICBsYWJlbD17XG4gICAgICAgICAgICAgICAgICAgICAgbGF5ZXIudmlzQ29uZmlnU2V0dGluZ3NbbGF5ZXIudmlzdWFsQ2hhbm5lbHNba2V5XS5yYW5nZV1cbiAgICAgICAgICAgICAgICAgICAgICAgIC5sYWJlbFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG5hbWU9e1xuICAgICAgICAgICAgICAgICAgICAgIGxheWVyLmNvbmZpZ1tsYXllci52aXN1YWxDaGFubmVsc1trZXldLmZpZWxkXVxuICAgICAgICAgICAgICAgICAgICAgICAgPyBsYXllci5jb25maWdbbGF5ZXIudmlzdWFsQ2hhbm5lbHNba2V5XS5maWVsZF0ubmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBsYXllci52aXN1YWxDaGFubmVsc1trZXldLmRlZmF1bHRNZWFzdXJlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH0pfVxuICAgICAgICA8L1N0eWxlZE1hcENvbnRyb2xMZWdlbmQ+XG4gICAgICApO1xuICAgIH0pfVxuICA8L2Rpdj5cbik7XG5cbk1hcExlZ2VuZC5wcm9wVHlwZXMgPSBwcm9wVHlwZXM7XG5cbmV4cG9ydCBkZWZhdWx0IE1hcExlZ2VuZDtcbiJdfQ==